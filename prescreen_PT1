<!DOCTYPE html>
<html>

<head>
  <title>prescreen_PT1</title>
  <script src="https://unpkg.com/jspsych@7.3.4" type="text/javascript"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.0.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-multi-select@1.1.3"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-multi-choice@1.1.3"></script>
  </head>
<body></body>



<script>

  // Initialize jsPsych and create timeline -----------------------------------------------------------------
  var jsPsych = initJsPsych({});
  var timeline = [];


  // Age --------------------------------------------------------------------------
var age = {
  type: jsPsychSurveyHtmlForm,
  preamble: '<p><strong>Quel âge avez-vous ?</strong><br>Insérez un nombre ci-dessous.</p>',
  html: '<input type="number" id="age" name="age" min="0" max="100" required><br><br>',
  data: { trial_name: 'age' },
  on_finish: function(data) {
    var responses = JSON.parse(data.responses);
    var age_value = parseInt(responses.age);
    // Si l'âge est inférieur à 18, exclusion
    if (age_value < 18) {
      jsPsych.endExperiment(
        'Merci, mais vous ne pouvez pas participer à cette étude car vous devez avoir au moins 18 ans.'
      );
    } 
  }
}
timeline.push(age);


// Question de familiarité avec la conduite --------------------------------------------------------------------------
var expe_conduite = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Concernant votre expérience de conduite automobile, cochez la ou les cases qui s’appliquent à votre situation :", 
      options: ["Je n’ai pas d’expérience de conduite",
                "Je pratique (ou ai pratiqué) la conduite accompagnée", 
                "Je suis en train de passer le permis voiture (permis B)", 
                "J’ai le permis voiture (permis B)", 
                "J’ai un permis de conduire autre que le permis B", 
                "J’utilise (ou ai utilisé) une voiture sans permis",
                "J’ai (ou avais) un deux roues motorisé (par ex. moto, scooter)"], 
      horizontal: false,
      required: true
    }
  ], 
  randomize_question_order: false
}
timeline.push(expe_conduite);


// Questions de conduite à montrer conditionellement --------------------------------------------------------------------------

// Conduite accompagnée
var conduite_acc = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Quand avez-vous commencé la conduite accompagnée ?",
      options: [
        "Il y a moins d’un mois",
        "Il y a 1-3 mois",
        "Il y a 4-6 mois",
        "Il y a 7-9 mois",
        "Il y a 10-12 mois",
        "Il y a plus d’un an"
      ],
      horizontal: false,
      required: true
    }
  ],
  on_finish: function(data) {
    var reponse = data.response.Q0; // Q0 = première (et unique) question

    if (reponse.includes("Il y a plus d’un an")) {
      jsPsych.endExperiment(
        "Merci, mais vous ne pouvez pas participer à cette étude car vous avez commencé la conduite accompagnée il y a plus d’un an."
      );
    }
  }
};

// permis B
var permis_B = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Quand avez-vous commencé à conduire en vue d’obtenir votre permis B ?", 
      options: ["Il y a moins d’un mois",
                "Il y a 1-3 mois", 
                "Il y a 4-6 mois", 
                "Il y a 7-9 mois", 
                "Il y a 10-12 mois", 
                "Il y a plus d’un an"], 
      horizontal: false,
      required: true,
      name: 'permis_B_start_time'
    }, 
    {
      prompt: "Quand avez-vous obtenu votre permis B ?", 
      options: ["Il y a moins d’un mois",
                "Il y a 1-3 mois", 
                "Il y a 4-6 mois", 
                "Il y a 7-9 mois", 
                "Il y a 10-12 mois", 
                "Il y a plus d’un an"], 
      horizontal: false,
      required: true,
      name: 'permis_B_obtention_time'
    }
  ],  
  randomize_question_order: false,

  on_finish: function(data) {
    var responses = data.response;
    var start_time = responses.permis_B_start_time;
    var obtention_time = responses.permis_B_obtention_time;

    // Vérifie si au moins une réponse contient "plus d’un an"
    if (
      start_time.includes("Il y a plus d’un an") ||
      obtention_time.includes("Il y a plus d’un an")
    ) {
      jsPsych.endExperiment(
        "Merci, mais vous ne pouvez pas participer à cette étude car votre expérience de conduite remonte à plus d’un an."
      );
    }
    // sinon, jsPsych continue naturellement
  }
};

  var heures_conduite = {
    type: jsPsychSurveyHtmlForm,
    preamble: '<p><strong>Combien d’heures de conduite à l’auto-école avez-vous réalisées en vue d’obtenir le permis ? </strong><br>Insérez un nombre ci-dessous.</p>',
    html: '<input type="number" id="heures_conduite" name="heures_conduite" min="0" max="500" required><br><br>',
  };

  // autre permis
var autre_permis_nom = {
    type: jsPsychSurveyHtmlForm,
    preamble: '<p><strong>Quel type de permis autre que le permis B avez-vous?</strong><br>Ecrivez ci-dessous.</p>',
    html: '<input type="text" id="autre_permis_nom" name="autre_permis_nom" required><br><br>',
  };

var permis_autre = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Quand avez-vous commencé à conduire en vue d’obtenir votre permis autre que le permis B ?", 
      options: ["Il y a moins d’un mois",
                "Il y a 1-3 mois", 
                "Il y a 4-6 mois", 
                "Il y a 7-9 mois", 
                "Il y a 10-12 mois", 
                "Il y a plus d’un an"], 
      horizontal: false,
      required: true,
      name: 'permis_autre_start_time'
    }, 
    {
      prompt: "Quand avez-vous obtenu votre permis autre que le permis B ?", 
      options: ["Il y a moins d’un mois",
                "Il y a 1-3 mois", 
                "Il y a 4-6 mois", 
                "Il y a 7-9 mois", 
                "Il y a 10-12 mois", 
                "Il y a plus d’un an"], 
      horizontal: false,
      required: true,
      name: 'permis_autre_obtention_time'
    }
  ],  
  randomize_question_order: false,
on_finish: function(data) {
    var responses = data.response;
    var start_time = responses.permis_B_start_time;
    var obtention_time = responses.permis_B_obtention_time;

    // Vérifie si au moins une réponse contient "plus d’un an"
    if (
      start_time.includes("Il y a plus d’un an") ||
      obtention_time.includes("Il y a plus d’un an")
    ) {
      jsPsych.endExperiment(
        "Merci, mais vous ne pouvez pas participer à cette étude car votre expérience de conduite remonte à plus d’un an."
      );
    }
    // sinon, jsPsych continue naturellement
  }
};

// véhicule sans permis
var vehic_sans_permis = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Quand avez-vous commencé à conduire votre voiture sans permis ?", 
      options: ["Il y a moins d’un mois",
                "Il y a 1-3 mois", 
                "Il y a 4-6 mois", 
                "Il y a 7-9 mois", 
                "Il y a 10-12 mois", 
                "Il y a plus d’un an"], 
      horizontal: false,
      required: true
    }
  ],
  on_finish: function(data) {
    var reponse = data.response.Q0; // Q0 = première (et unique) question

    if (reponse.includes("Il y a plus d’un an")) {
      jsPsych.endExperiment(
        "Merci, mais vous ne pouvez pas participer à cette étude car votre expérience de conduite remonte à plus d’un an."
      );
    }
  }
};

// deux roues
var deux_roues_mot = {
  type: jsPsychSurveyMultiSelect,
  questions: [
    {
      prompt: "Quand avez-vous commencé à conduire votre deux roues motorisé ?", 
      options: ["Il y a moins d’un mois",
                "Il y a 1-3 mois", 
                "Il y a 4-6 mois", 
                "Il y a 7-9 mois", 
                "Il y a 10-12 mois", 
                "Il y a plus d’un an"], 
      horizontal: false,
      required: true
    }
  ],
  on_finish: function(data) {
    var reponse = data.response.Q0; // Q0 = première (et unique) question

    if (reponse.includes("Il y a plus d’un an")) {
      jsPsych.endExperiment(
        "Merci, mais vous ne pouvez pas participer à cette étude car votre expérience de conduite remonte à plus d’un an."
      );
    }
  }
};

// Conditional display node --------------------------------------------------------------------------

// conduite accompagnée
var if_conduite_acc = {
  timeline: [conduite_acc],
  conditional_function: function() {
    var data = jsPsych.data.get().filter({trial_name: 'expe_conduite'}).last(1).values()[0];
    var response = JSON.parse(data.response)["Q0"];
    return response.includes("Je pratique (ou ai pratiqué) la conduite accompagnée");
  }
};

// If "permis B" (either currently passing or already have it)
var if_permis_B = {
  timeline: [permis_B, heures_conduite],
  conditional_function: function() {
    var data = jsPsych.data.get().filter({trial_name: 'expe_conduite'}).last(1).values()[0];
    var response = JSON.parse(data.response)["Q0"];
    return (
      response.includes("Je suis en train de passer le permis voiture (permis B)") ||
      response.includes("J’ai le permis voiture (permis B)")
    );
  }
};

// If "autre permis"
var if_autre_permis = {
  timeline: [autre_permis_nom, permis_autre],
  conditional_function: function() {
    var data = jsPsych.data.get().filter({trial_name: 'expe_conduite'}).last(1).values()[0];
    var response = JSON.parse(data.response)["Q0"];
    return response.includes("J’ai un permis de conduire autre que le permis B");
  }
};

// If "voiture sans permis"
var if_vehic_sans_permis = {
  timeline: [vehic_sans_permis],
  conditional_function: function() {
    var data = jsPsych.data.get().filter({trial_name: 'expe_conduite'}).last(1).values()[0];
    var response = JSON.parse(data.response)["Q0"];
    return response.includes("J’utilise (ou ai utilisé) une voiture sans permis");
  }
};

// If "deux roues motorisé"
var if_deux_roues = {
  timeline: [deux_roues_mot],
  conditional_function: function() {
    var data = jsPsych.data.get().filter({trial_name: 'expe_conduite'}).last(1).values()[0];
    var response = JSON.parse(data.response)["Q0"];
    return response.includes("J’ai (ou avais) un deux roues motorisé (par ex. moto, scooter)");
  }
};

// Push to timeline
timeline.push(
  if_conduite_acc,
  if_permis_B,
  if_autre_permis,
  if_vehic_sans_permis,
  if_deux_roues
);

// Questions vulnérabilité --------------------------------------------------------------------------
var vulnerabilite = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {
      prompt: "<p>Si vous rentrez dans l’une des situations suivantes, cochez la case “Oui” ci-dessous. Sinon, cochez la case “Non”.</p>
              <ul>
                <li>Je souffre d’épilepsie photosensible</li>
                <li>J’ai le mal des transports</li>
                <li>J’ai un dysfonctionnement du système nerveux autonome</li>
                <li>Je suis enceinte</li>
                <li>J’ai un trouble vestibulaire</li>
                <li>J’ai un trouble de la proprioception</li>
                <li>J’ai un trouble oculomoteur</li>
                <li>Je souffre de migraines</li>
              </ul>", 
      name: 'vulnerabilite', 
      options: ['Oui', 'Non'], 
     required: true
    }
  ],
  on_finish: function(data) {
    var reponse = data.response.vulnerabilite;

    if (reponse === 'Oui') {
      jsPsych.endExperiment('Merci de votre inétrêt. Malheureusement, vous ne pouvez pas participer à cette étude pour des raisons de sécurité. <br> Vous pouvez fermer la page web.');
    } else {
      // message deredicrection SONA
      document.body.innerHTML = `
        <div style="text-align:center; font-size:20px; margin-top:50px;">
          <p>Merci pour votre réponse.</p>
          <p>Vous allez être redirigé vers Sona. Ensuite, vous pourrez vous inscrre pour participer à l'étude.</p>
          <p><em>Redirection automatique dans quelques secondes...</em></p>
        </div>
      `;

      // Redirige après 3 secondes
      setTimeout(function(){
        window.location.href = "https://yourschool.sona-systems.com/webstudy_credit.aspx?experiment_id=XXX&credit_token=YYY";
      }, 3000);
    }
  }
}
timeline.push(vulnerabilite);







